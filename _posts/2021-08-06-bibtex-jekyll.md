---
layout: post
title: "BibTeX For Jekyll Using jekyll-scholar"
categories: tutorial
tags: bibtex jekyll
---

> I made a long Jekyll tutorial covering lots of different features, but the references mini-tutorial became not-so-mini so I moved it to its own post.

<!--more-->

- TOC
{:toc}

## References/Citations in Jekyll

Say you want to add references on your page. Instead of generating them outside of jekyll and copying them to the bottom of your post, or worse, typing them out by hand, you can let a package called jekyll-scholar take care of it all within jekyll.

## BibTeX

[BibTeX](http://www.bibtex.org/) is "a tool and a file format which are used to describe and process lists of references, mostly in conjunction with LaTeX documents." A BibTeX entry looks something like this:

```bib
@book{Sutton1998,
  added-at = {2019-07-13T10:11:53.000+0200},
  author = {Sutton, Richard S. and Barto, Andrew G.},
  biburl = {https://www.bibsonomy.org/bibtex/2f46601cf8b13d39d1378af0d79438b12/lanteunis},
  edition = {Second},
  interhash = {ac6b144aaec1819919a2fba9f705c852},
  intrahash = {f46601cf8b13d39d1378af0d79438b12},
  publisher = {The MIT Press},
  timestamp = {2019-07-13T10:11:53.000+0200},
  title = {Reinforcement Learning: An Introduction},
  url = {http://incompleteideas.net/book/the-book-2nd.html},
  year = {2018},
  link = {http://incompleteideas.net/book/RLbook2020.pdf}
}
```

You don't usually have to worry about constructing these. The entry comes all in one piece wherever the article is published so you can easily copy/paste it. You can still modify it; I added `link` to point to a pdf version of the book.

{% include callout.html content="If you get a bunch of warnings with the message 'Warning: Empty 'slug' generated for ''.' in the terminal, then it's probably due to empty items in a bibtex entry. See this issue: https://github.com/jekyll/jekyll/issues/7881. Try not to have entries that look like {} or ''." icon="neutral"%}

## Basics

Add it to the Gemfile and run `bundle install`
```gemfile
group :jekyll_plugins do
  gem "jekyll-scholar"
```

Add it to \_config.yml to use it:
```yaml
plugins:
  - jekyll-scholar
```

Restart the server and it should be ready to go.

Jekyll-scholar allows you to generate references and citations from bibtex files, much like in a LaTeX environment. It's pretty customizable, and the [repo's readme](https://github.com/inukshuk/jekyll-scholar) has good documentation (for once). The basics are:
- Keep all your references in \_bibliography/references.bib
- Use {%raw%}`{% bibliography %}`{%endraw%} wherever you want to list your references (in the post layout for example).
- Use {%raw%}`{% cite bibliography-entry %}`{%endraw%} whenever you want to cite a specific entry, replacing bibliography-entry with the entry id. Unfortunately it may have to go in the Markdown of your post.

## Custom Citation Style

Some things to consider when you're customizing your references. The tag {%raw%}`{{reference}}`{%endraw%} gives the core reference element. The plugin will always output an ordered list, and customization will modify each list item inclusive of the {%raw%}`{{reference}}`{%endraw%}, but the format of the actual reference element is determined by a cls file. The [csl repo](https://github.com/citation-style-language/styles) has a list of presets to choose from. For example, I like the [IEEE](https://libguides.murdoch.edu.au/IEEE/home) style better than APA, so I swapped it by adding this to \config.yml:
```yaml
scholar:
  style: ieee
```

The value of the style parameter is just a style from the csl repo without the .csl file extension.

I ran into some problems though. First, IEEE is a numbered style, so the csl file would generate a number redundant with the number in the HTML list.

![ref-redundant][ref-redundant]

I found a solution buried in [here](https://martinopilia.com/posts/2020/02/22/migration.html). First, copy ieee.csl from the csl repo into \_bibliography/ieee_custom.csl and customize it. It looks pretty hefty but here's the gist of the structure:
- a bunch of macros
- a citation block
- and a bibliography block

Down in the bibliography block, comment out the citation number:
```xml
<bibliography entry-spacing="0" second-field-align="flush">
  <layout suffix=".">
    <!-- Citation Number -->
    <!-- <text variable="citation-number" prefix="[" suffix="] "/> -->
    <!-- Author(s) -->
    <text macro="author" suffix=", "/>
```

Point to the new csl file in \_config.yml:
```yaml
scholar:
  style: _/bibliography/ieee_custom.csl
```

Now edit the CSS of the numerals generated by jekyll-scholar, to satisfy the IEEE style:
```css
ol.bibliography {
  counter-reset: item
}

ol.bibliography li {
  list-style-type: none;
}

ol.bibliography li:before {
  content: "[" counter(item) "] ";
  counter-increment: item;
  position: absolute;
  text-align: right;
  width: 4em;
  margin-left: -4.4em;
}
```

![ref-fixed][ref-fixed]
*That does the trick.*

{% include callout.html content="Warning: edits to the csl file seem to require restarting the jekyll server." icon="neutral"%}

## Link To Resource

I also wanted to make the csl file add an HTML link around the title pointing to the resource (like the url for a pdf of a research paper), as long as the reference had a link field in the bibtex (references.bib). Unfortunately the solutions I found looked pretty hacky so I settled for putting the link outside the csl-generated reference. To do this, just modify the list element using a [bibliography template](https://github.com/inukshuk/jekyll-scholar#bibliography-template) at \_layouts/bibitem.html.

{%raw%}
```html
<span>{{reference}}</span>
{% if entry.link %} 
<a href="{{ entry.link }}">[link]</a>
{% endif %}
```
{%endraw%}

Add it to the config:

{%raw%}
```yaml
scholar:
  ...
  bibliography_template: bibitem
```
{%endraw%}

![ref-link][ref-link]

## Adding To Post Layout

One last thing I wanted was the ability to put the references in the post layout so a) I could place it below the footnotes and b) I wouldn't have to manually add it in every post. The first step is to put {%raw%}`{% bibliography --cited %}`{%endraw%} in the post template, to show only elements of the bibliography you have cited on the page. Unfortunately if you have a header like `<h2>References</h2>`, then it will show up even if there are no citations in the post. Here's my solution:

{%raw%}
```html
{% capture count %}{% bibliography_count --cited %}{% endcapture %}
{% assign count = count | plus: 0 %}
{% if count > 0 %}
<h2>References</h2>
{% endif %}
<div class="post-bibliography">
{% bibliography --cited %}
</div>
```
{%endraw%}

The first line gets a string representing the number of references cited on the page and stores it in `count`. It gets converted to a number in the second line, and used in the third to show the header only if there are one or more references cited on the page.

## Unresolved Issues

When I cited a reference using a BibTeX key with two periods, the citation wouldn't render. That is, something like {%raw%}`{% cite 10.55553304652.3304675 %}`{%endraw%} turned into "(missing reference)". For now I just change the key in the BibTeX entry to something without two periods.

[ref-redundant]: /assets/images/ref-redundant.png
[ref-fixed]: /assets/images/ref-fixed.png
[ref-link]: /assets/images/ref-link.png